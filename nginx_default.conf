server {
    listen 80 default_server;
    server_name _;
    client_max_body_size 50M;
    
    # Increase buffer size for large headers (e.g. cookies)
    large_client_header_buffers 4 32k;
    client_header_buffer_size 8k;

    # TryEdit/Antigravity (Port 80 -> 3000)
    location / {
        proxy_pass http://127.0.0.1:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}

server {
    listen 81;
    server_name _;
    client_max_body_size 50M;
    large_client_header_buffers 4 32k;

    # AuditFlow (Port 81 -> 3002)
    location / {
        proxy_pass http://127.0.0.1:3002;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}

server {
    listen 82;
    server_name _;
    client_max_body_size 50M;
    large_client_header_buffers 4 32k;

    # Portfolio (Port 82 -> 3003)
    location / {
        proxy_pass http://127.0.0.1:3003;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
